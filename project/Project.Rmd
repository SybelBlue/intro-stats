---
title: "Project"
author: "Logan Caraco"
date: "2/16/2021"
output: html_document
---

```{r setup, echo = FALSE, warning = FALSE}
knitr::opts_chunk$set(collapse = TRUE, warning = FALSE, message = FALSE, fig.align = 'center')
```


```{r, message=FALSE}
library(ggplot2)

library(dplyr)
library(magrittr)
```


```{r}
raw_survey_data <- read.csv("https://www.macalester.edu/~ajohns24/data/pulse_of_the_nation.csv")

names(raw_survey_data) <- c("income", "gender", "age", "party", "trump_approval", "education", "marital", "robots", "climate_change", "transformers", "science_is_honest", "vaccines_are_safe", "books", "ghosts", "fed_sci_budget", "earth_sun", "wise_unwise")

raw_survey_data <- raw_survey_data %>% 
  mutate(climate_change_binary = (climate_change == "Real and Caused by People"))

head(raw_survey_data)
```


  variable |	survey questions
  ---------+-----------------
  `income` |	What is your income (in $1000s per year)?
  `gender` |	What gender do you identify with (female, male, other)?
  `age` |	What is your age?
  `party` |	In politics today, do you consider yourself a Democrat, a Republican, or Independent?
  `trump_approval` |	Do you approve, disapprove, or neither approve nor disapprove of how Donald Trump is handling his job as president?
  `education` |	What is your highest level of education?
  `marital` |	What is your marital status?
  `robots` |	What would you say is the likelihood that your current job will be entirely performed by robots or computers within the next decade?
  `climate_change` |	Do you believe that climate change is real and caused by people, real but not caused by people, or not real at all?
   `climate_change_binary` | Do you believe that climate change is real and caused by people or not?
  `transformers` |	How many Transformers movies have you seen?
  `science_is_honest` |	Do you agree or disagree with the following statement: scientists are generally honest and are serving the public good.
  `vaccines_are_safe` |	Do you agree or disagree with the following statement: vaccines are safe and protect children from disease.
  `books` |	How many books, if any, have you read in the past year?
  `ghosts` |	Do you believe in ghosts?
  `fed_sci_budget` |	Is federal funding of scientific research too high, too low, or about right?
  `earth_sun` |	True or false: the earth is always farther away from the sun in the winter than in the summer (in the northern hemisphere).
  `wise_unwise` |	If you had to choose: would you rather be wise and unhappy, or unwise and happy?
  
```{r}
is.known <- function (x) { x != "DK/REF" }
marital_trump <- raw_survey_data %>%
  select(age, gender, marital, trump_approval, books) %>%
  filter(is.known(trump_approval), is.known(marital), is.finite(age), 18 <= age, age <= 90) %>%
  mutate(approves_trump = endsWith(trump_approval, "Approve")) %>%
  mutate(is_married = marital == "Married")
```

``` {r}
approval_model <- glm(approves_trump ~ age * is_married, marital_trump, family = "binomial")
summary(approval_model)$coefficients

approval_predictions <- marital_trump %>% 
  mutate(log_odds = approval_model$fitted.values) %>% 
  mutate(odds = exp(log_odds)) %>% 
  mutate(probability = odds / (1 + odds))
```

``` {r}
marital_model <- glm(is_married ~ age, marital_trump, family = "binomial")
summary(marital_model)$coefficients

marital_predictions <- marital_trump %>% 
  mutate(log_odds = marital_model$fitted.values) %>% 
  mutate(odds = exp(log_odds)) %>% 
  mutate(probability = odds / (1 + odds))
```

``` {r}
ggplot(approval_predictions, aes(x = age, y = probability, color = is_married)) + 
  geom_smooth(se = FALSE) +
  xlim(18, 88)
```

  
```{r}
ggplot(marital_trump, aes(x = age, color = approves_trump)) +
  geom_boxplot() +
  facet_wrap(~is_married)
```

```{r}
confint(approval_model, level = 0.95)

ggplot(approval_predictions, aes(x = age, y = probability, color = is_married)) +
  geom_smooth(method = "lm") +
  xlim(18, 88)
```